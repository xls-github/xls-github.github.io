I"š&<p>MongoDBæ˜¯ä¸€ä¸ªNoSQLçš„æ–‡æ¡£å‹çš„æ•°æ®åº“ï¼Œæ•°æ®åº“ä¸­å­˜å‚¨çš„æ•°æ®çš„åŸºæœ¬å•ä½å°±æ˜¯æ–‡æ¡£ï¼Œåœ¨MongoDBæ•°æ®åº“ä½¿ç”¨çš„æ˜¯JavaScriptè¿›è¡Œæ“ä½œçš„ï¼Œåœ¨MongoDBå«æœ‰ä¸€ä¸ªå¯¹ESæ ‡å‡†å®ç°çš„å¼•æ“ï¼Œåœ¨MongoDBä¸­æ‰€æœ‰ESä¸­çš„è¯­æ³•ä¸­éƒ½å¯ä»¥ä½¿ç”¨ã€‚</p>
<ul>
  <li>MongoDBçš„åŸºæœ¬çš„æŒ‡ä»¤
    <ul>
      <li>å¯åŠ¨æœåŠ¡å™¨
  mongod</li>
      <li>å¯åŠ¨å®¢æˆ·ç«¯
  mongo</li>
    </ul>
  </li>
  <li>MongoDBçš„CRUDï¼ˆå¢åˆ æ”¹æŸ¥ï¼‰çš„æ“ä½œ
    <ul>
      <li>åŸºæœ¬æ“ä½œ
  use æ•°æ®åº“
      - è¿›å…¥æŒ‡å®šçš„æ•°æ®åº“
  show dbs
      - æ˜¾ç¤ºæ‰€æœ‰çš„æ•°æ®åº“
  show collections
      - æ˜¾ç¤ºæ•°æ®åº“ä¸­æ‰€æœ‰çš„é›†åˆ
  db
      - æ˜¾ç¤ºå½“å‰æ‰€åœ¨çš„æ•°æ®åº“</li>
      <li>å‘æ•°æ®åº“ä¸­æ’å…¥æ–‡æ¡£ï¼ˆcollectionè¡¨ç¤ºå½“å‰è¦æ“ä½œçš„é›†åˆ(æ„Ÿè§‰ç›¸å½“äºSqlServeré‡Œçš„è¡¨)ï¼‰
        <ul>
          <li>db.collection.insert()
            <ul>
              <li>å¯ä»¥å‘é›†åˆä¸­æ’å…¥ä¸€ä¸ªæˆ–å¤šä¸ªæ–‡æ¡£ï¼ˆæœ‰å‚æ•°å¯ä»¥é€‰æ‹©ï¼‰</li>
              <li>å½“æˆ‘ä»¬å‘é›†åˆä¸­æ’å…¥æ–‡æ¡£æ—¶ï¼Œæ•°æ®åº“ä¼šè‡ªåŠ¨ä¸ºæ–‡æ¡£æ·»åŠ _idä½œä¸ºæ–‡æ¡£çš„å”¯ä¸€æ ‡è¯†</li>
              <li>_idå¯ä»¥è‡ªå·±æŒ‡å®šï¼Œå¿…é¡»ç¡®ä¿å®ƒçš„å”¯ä¸€æ€§</li>
            </ul>
          </li>
          <li>db.collection.insertOne()
            <ul>
              <li>å‘é›†åˆä¸­æ’å…¥ä¸€ä¸ªæ–‡æ¡£</li>
            </ul>
          </li>
          <li>db.collection.insertMany()
            <ul>
              <li>å‘é›†åˆä¸­æ’å…¥å¤šä¸ªæ–‡æ¡£</li>
            </ul>
          </li>
        </ul>
      </li>
      <li>æŸ¥è¯¢æ•°æ®åº“ä¸­çš„æ–‡æ¡£
        <ul>
          <li>db.collection.find()
            <ul>
              <li>å¯ä»¥æ ¹æ®æŒ‡å®šæ¡ä»¶ä»é›†åˆä¸­æŸ¥è¯¢æ‰€æœ‰ç¬¦åˆæ¡ä»¶çš„æ–‡æ¡£ï¼Œè¿”å›çš„æ˜¯list</li>
              <li>find()å¯ä»¥æ¥æ”¶ä¸€ä¸ªå¯¹è±¡ä½œä¸ºæ¡ä»¶å‚æ•° 
  {å±æ€§:å€¼} æŸ¥è¯¢å±æ€§æ˜¯æŒ‡å®šå€¼çš„æ–‡æ¡£</li>
            </ul>
          </li>
          <li>db.collection.findOne()
            <ul>
              <li>æŸ¥è¯¢ç¬¬ä¸€ä¸ªç¬¦åˆæ¡ä»¶çš„æ–‡æ¡£ï¼Œè¿”å›çš„æ˜¯å¯¹è±¡</li>
            </ul>
          </li>
          <li>db.collection.find().count()
            <ul>
              <li>æŸ¥è¯¢ç¬¦åˆæ¡ä»¶çš„æ–‡æ¡£çš„æ•°é‡</li>
            </ul>
          </li>
        </ul>
      </li>
      <li>ä¿®æ”¹æ•°æ®åº“ä¸­çš„æ–‡æ¡£
        <ul>
          <li>db.collection.update()
            <ul>
              <li>å¯ä»¥ä¿®æ”¹ã€æ›¿æ¢é›†åˆä¸­çš„ä¸€ä¸ªæˆ–å¤šä¸ªæ–‡æ¡£ï¼ˆåŒinsert()ä¸€æ ·ï¼Œå¯ä»¥é€‰å‚æ•°ï¼Œé»˜è®¤ä¿®æ”¹ä¸€ä¸ªï¼‰</li>
              <li>update()é»˜è®¤æƒ…å†µä¸‹ä¼šä½¿ç”¨æ–°å¯¹è±¡æ¥æ›¿æ¢æ—§çš„å¯¹è±¡</li>
              <li>å¦‚æœéœ€è¦ä¿®æ”¹æŒ‡å®šçš„å±æ€§ï¼Œè€Œä¸æ˜¯æ›¿æ¢éœ€è¦ä½¿ç”¨â€œä¿®æ”¹æ“ä½œç¬¦â€æ¥å®Œæˆä¿®æ”¹
  $set ä¿®æ”¹æ–‡æ¡£ä¸­çš„æŒ‡å®šå±æ€§
  $unset åˆ é™¤æ–‡æ¡£çš„æŒ‡å®šå±æ€§</li>
            </ul>
          </li>
          <li>db.collection.updateOne()
            <ul>
              <li>ä¿®æ”¹é›†åˆä¸­çš„ä¸€ä¸ªæ–‡æ¡£</li>
            </ul>
          </li>
          <li>db.collection.updateMany()
            <ul>
              <li>ä¿®æ”¹é›†åˆä¸­çš„å¤šä¸ªæ–‡æ¡£</li>
            </ul>
          </li>
          <li>db.collection.replaceOne()
            <ul>
              <li>æ›¿æ¢é›†åˆä¸­çš„ä¸€ä¸ªæ–‡æ¡£</li>
              <li>åˆ é™¤é›†åˆä¸­çš„æ–‡æ¡£(ä¸€èˆ¬å¼€å‘ä¸­ä¸ä¼šåˆ é™¤ä¸œè¥¿ï¼Œä¸å¸¸ç”¨ï¼Œä¸€èˆ¬ä¼šåœ¨æ•°æ®ä¸­æ·»åŠ ä¸€ä¸ªå­—æ®µï¼Œæ¥è¡¨ç¤ºæ•°æ®æ˜¯å¦è¢«åˆ é™¤)</li>
            </ul>
          </li>
          <li>db.collection.remove()
            <ul>
              <li>åˆ é™¤é›†åˆä¸­çš„ä¸€ä¸ªæˆ–å¤šä¸ªæ–‡æ¡£ï¼ˆé»˜è®¤åˆ é™¤å¤šä¸ªï¼‰</li>
            </ul>
          </li>
          <li>db.collection.deleteOne()
            <ul>
              <li>åˆ é™¤é›†åˆä¸­çš„ä¸€ä¸ªæ–‡æ¡£</li>
            </ul>
          </li>
          <li>db.collection.deleteMany()
            <ul>
              <li>åˆ é™¤é›†åˆä¸­çš„å¤šä¸ªæ–‡æ¡£</li>
            </ul>
          </li>
          <li>æ¸…ç©ºä¸€ä¸ªé›†åˆ
  db.collection.remove({})</li>
          <li>åˆ é™¤ä¸€ä¸ªé›†åˆ
  db.collection.drop()</li>
          <li>åˆ é™¤ä¸€ä¸ªæ•°æ®åº“
  db.dropDatabase()
 æ–‡æ¡£ä¹‹é—´çš„å…³ç³»
  ä¸€å¯¹ä¸€ï¼ˆone to oneï¼‰å¯ä»¥é€šè¿‡å†…åµŒæ–‡æ¡£çš„å½¢å¼æ¥ä½“ç°å‡ºä¸€å¯¹ä¸€çš„å…³ç³»
  ä¸€å¯¹å¤šï¼ˆone to manyï¼‰/å¤šå¯¹ä¸€(many to one)
  å¤šå¯¹å¤š(many to many)</li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<p>ä¸€äº›ä¾‹å­</p>

<p>//1.è¿›å…¥my_testæ•°æ®åº“
use my_test</p>

<p>//2.å‘æ•°æ®åº“çš„useré›†åˆä¸­æ’å…¥ä¸€ä¸ªæ–‡æ¡£<br />
db.users.insert({
    username:â€sunwukongâ€
});</p>

<p>//3.æŸ¥è¯¢useré›†åˆä¸­çš„æ–‡æ¡£
db.users.find();</p>

<p>//4.å‘æ•°æ®åº“çš„useré›†åˆä¸­æ’å…¥ä¸€ä¸ªæ–‡æ¡£ <br />
db.users.insert({
    username:â€zhubajieâ€
});</p>

<p>//5.æŸ¥è¯¢æ•°æ®åº“useré›†åˆä¸­çš„æ–‡æ¡£
db.users.find();</p>

<p>//6.ç»Ÿè®¡æ•°æ®åº“useré›†åˆä¸­çš„æ–‡æ¡£æ•°é‡
db.users.find().count();</p>

<p>//7.æŸ¥è¯¢æ•°æ®åº“useré›†åˆä¸­usernameä¸ºsunwukongçš„æ–‡æ¡£
db.users.find({username:â€sunwukongâ€});</p>

<p>//8.å‘æ•°æ®åº“useré›†åˆä¸­çš„usernameä¸ºsunwukongçš„æ–‡æ¡£ï¼Œæ·»åŠ ä¸€ä¸ªaddresså±æ€§ï¼Œå±æ€§å€¼ä¸ºhuaguoshan
db.users.update({username:â€sunwukongâ€},{$set:{address:â€huaguoshanâ€}});</p>

<p>//9.ä½¿ç”¨{username:â€tangsengâ€} æ›¿æ¢ username ä¸º zhubajieçš„æ–‡æ¡£
db.users.replaceOne({username:â€zhubajieâ€},{username:â€tangsengâ€});</p>

<p>//10.åˆ é™¤usernameä¸ºsunwukongçš„æ–‡æ¡£çš„addresså±æ€§
db.users.update({username:â€sunwukongâ€},{$unset:{address:1}});</p>

<p>//11.å‘usernameä¸ºsunwukongçš„æ–‡æ¡£ä¸­ï¼Œæ·»åŠ ä¸€ä¸ªhobby:{cities:[â€œbeijingâ€,â€shanghaiâ€,â€shenzhenâ€] , movies:[â€œsanguoâ€,â€heroâ€]}
//MongoDBçš„æ–‡æ¡£çš„å±æ€§å€¼ä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ªæ–‡æ¡£ï¼Œå½“ä¸€ä¸ªæ–‡æ¡£çš„å±æ€§å€¼æ˜¯ä¸€ä¸ªæ–‡æ¡£æ—¶ï¼Œæˆ‘ä»¬ç§°è¿™ä¸ªæ–‡æ¡£å«åš å†…åµŒæ–‡æ¡£
db.users.update({username:â€sunwukongâ€},{$set:{hobby:{cities:[â€œbeijingâ€,â€shanghaiâ€,â€shenzhenâ€] , movies:[â€œsanguoâ€,â€heroâ€]}}});
db.users.find();</p>

<p>//12.å‘usernameä¸ºtangsengçš„æ–‡æ¡£ä¸­ï¼Œæ·»åŠ ä¸€ä¸ªhobby:{movies:[â€œA Chinese Odysseyâ€,â€King of comedyâ€]}
db.users.update({username:â€tangsengâ€},
{$set:{hobby:{movies:[â€œA Chinese Odysseyâ€,â€King of comedyâ€]}}})</p>

<p>//13.æŸ¥è¯¢å–œæ¬¢ç”µå½±heroçš„æ–‡æ¡£
//MongoDBæ”¯æŒç›´æ¥é€šè¿‡å†…åµŒæ–‡æ¡£çš„å±æ€§è¿›è¡ŒæŸ¥è¯¢ï¼Œå¦‚æœè¦æŸ¥è¯¢å†…åµŒæ–‡æ¡£åˆ™å¯ä»¥é€šè¿‡.çš„å½¢å¼æ¥åŒ¹é…
//å¦‚æœè¦é€šè¿‡å†…åµŒæ–‡æ¡£æ¥å¯¹æ–‡æ¡£è¿›è¡ŒæŸ¥è¯¢ï¼Œæ­¤æ—¶å±æ€§åå¿…é¡»ä½¿ç”¨å¼•å· 
db.users.find({â€˜hobby.moviesâ€™:â€heroâ€});</p>

<p>//14.å‘tangsengä¸­æ·»åŠ ä¸€ä¸ªæ–°çš„ç”µå½±Interstellar
//$push ç”¨äºå‘æ•°ç»„ä¸­æ·»åŠ ä¸€ä¸ªæ–°çš„å…ƒç´ 
//$addToSet å‘æ•°ç»„ä¸­æ·»åŠ ä¸€ä¸ªæ–°å…ƒç´  ï¼Œ å¦‚æœæ•°ç»„ä¸­å·²ç»å­˜åœ¨äº†è¯¥å…ƒç´ ï¼Œåˆ™ä¸ä¼šæ·»åŠ </p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>db.users.update({username:"tangseng"},
{$push:{"hobby.movies":"Interstellar"}});
db.users.update({username:"tangseng"},
{$addToSet:{"hobby.movies":"Interstellar"}});
db.users.find();
</code></pre></div></div>

<p>//15.åˆ é™¤å–œæ¬¢beijingçš„ç”¨æˆ·
db.users.remove({â€œhobby.citiesâ€:â€beijingâ€});</p>

<p>//16.åˆ é™¤useré›†åˆ
db.users.remove({});
db.users.drop();</p>

<p>show dbs;</p>

<p>//17.å‘numbersä¸­æ’å…¥20000æ¡æ•°æ® 7.2s
for(var i=1 ; i&lt;=20000 ; i++){
    db.numbers.insert({num:i});
}</p>

<p>db.numbers.find()</p>

<p>db.numbers.remove({});</p>

<p>//0.4s
var arr = [];</p>

<p>for(var i=1 ; i&lt;=20000 ; i++){
    arr.push({num:i});
}</p>

<p>db.numbers.insert(arr);</p>

<p>//18.æŸ¥è¯¢numbersä¸­numä¸º500çš„æ–‡æ¡£
db.numbers.find({num:500})</p>

<p>//19.æŸ¥è¯¢numbersä¸­numå¤§äº5000çš„æ–‡æ¡£</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>db.numbers.find({num:{$gt:500}});
db.numbers.find({num:{$eq:500}});
</code></pre></div></div>

<p>//20.æŸ¥è¯¢numbersä¸­numå°äº30çš„æ–‡æ¡£
db.numbers.find({num:{$lt:30}});</p>

<p>//21.æŸ¥è¯¢numbersä¸­numå¤§äº40å°äº50çš„æ–‡æ¡£
db.numbers.find({num:{$gt:40 , $lt:50}});</p>

<p>//22.æŸ¥è¯¢numbersä¸­numå¤§äº19996çš„æ–‡æ¡£
db.numbers.find({num:{$gt:19996}});</p>

<p>//23.æŸ¥çœ‹numbersé›†åˆä¸­çš„å‰10æ¡æ•°æ®
db.numbers.find({num:{$lte:10}});</p>

<p>//limit()è®¾ç½®æ˜¾ç¤ºæ•°æ®çš„ä¸Šé™
db.numbers.find().limit(10);
//åœ¨å¼€å‘æ—¶ï¼Œæˆ‘ä»¬ç»å¯¹ä¸ä¼šæ‰§è¡Œä¸å¸¦æ¡ä»¶çš„æŸ¥è¯¢
db.numbers.find();</p>

<p>//24.æŸ¥çœ‹numbersé›†åˆä¸­çš„ç¬¬11æ¡åˆ°20æ¡æ•°æ®
/*
    åˆ†é¡µ æ¯é¡µæ˜¾ç¤º10æ¡
        1-10     0
        11-20    10
        21-30    20
        ã€‚ã€‚ã€‚</p>

<p>skip((é¡µç -1) * æ¯é¡µæ˜¾ç¤ºçš„æ¡æ•°).limit(æ¯é¡µæ˜¾ç¤ºçš„æ¡æ•°);</p>

<p>skip()ç”¨äºè·³è¿‡æŒ‡å®šæ•°é‡çš„æ•°æ®</p>

<p>MongoDBä¼šè‡ªåŠ¨è°ƒæ•´skipå’Œlimitçš„ä½ç½®
*/
db.numbers.find().skip(10).limit(10);</p>

<p>//25.æŸ¥çœ‹numbersé›†åˆä¸­çš„ç¬¬21æ¡åˆ°30æ¡æ•°æ®
db.numbers.find().skip(20).limit(10);</p>

<p>db.numbers.find().limit(10).skip(10);</p>

<p>//26.å°†deptå’Œempé›†åˆå¯¼å…¥åˆ°æ•°æ®åº“ä¸­
db.dept.find()
db.emp.find()</p>

<p>//27.æŸ¥è¯¢å·¥èµ„å°äº2000çš„å‘˜å·¥
db.emp.find({sal:{$lt:2000}});</p>

<p>//28.æŸ¥è¯¢å·¥èµ„åœ¨1000-2000ä¹‹é—´çš„å‘˜å·¥
db.emp.find({sal:{$lt:2000 , $gt:1000}});</p>

<p>//29.æŸ¥è¯¢å·¥èµ„å°äº1000æˆ–å¤§äº2500çš„å‘˜å·¥</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>db.emp.find({$or:[{sal:{$lt:1000}} , {sal:{$gt:2500}}]});
</code></pre></div></div>

<p>//30.æŸ¥è¯¢è´¢åŠ¡éƒ¨çš„æ‰€æœ‰å‘˜å·¥
//(depno)
var depno = db.dept.findOne({dname:â€è´¢åŠ¡éƒ¨â€}).deptno;
db.emp.find({depno:depno});</p>

<p>//31.æŸ¥è¯¢é”€å”®éƒ¨çš„æ‰€æœ‰å‘˜å·¥
var depno = db.dept.findOne({dname:â€é”€å”®éƒ¨â€}).deptno;
db.emp.find({depno:depno});</p>

<p>//32.æŸ¥è¯¢æ‰€æœ‰mgrä¸º7698çš„æ‰€æœ‰å‘˜å·¥
db.emp.find({mgr:7698})</p>

<p>//33.ä¸ºæ‰€æœ‰è–ªèµ„ä½äº1000çš„å‘˜å·¥å¢åŠ å·¥èµ„400å…ƒ</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>db.emp.updateMany({sal:{$lte:1000}} , {$inc:{sal:400}});
db.emp.find()
</code></pre></div></div>
:ET